# Copyright 2025 长林啊 <767425412@qq.com>. All rights reserved.
# Use of this source code is governed by a MIT style
# license that can be found in the LICENSE file. The original repo for
# this file is https://github.com/clin211/miniblog-v2.git.

services:
  mysql:
    image: mysql:8.0
    container_name: miniblog-mysql
    restart: always
    ports:
      - "11006:3306"
    environment:
      MYSQL_ROOT_PASSWORD: 123456
      MYSQL_USER: miniblog
      MYSQL_PASSWORD: CueD7wbmJHxY
      MYSQL_DATABASE: miniblog_v2
    volumes:
      - ./.dbdata/mysql-data:/var/lib/mysql
    command: --default-authentication-plugin=mysql_native_password

  mongo:
    image: mongo
    restart: always
    container_name: "miniblog-mongo"
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: r8SggC783Xh1
      # 设置初始化数据库
      MONGO_INITDB_DATABASE: miniblog_v2
    ports:
      - 27001:27017 # 将MongoDB的默认端口映射到宿主机的27001端口上来
    volumes: # 数据持久化配置
      - ./.dbdata/mongo:/data/db # 将容器内部的数据映射到宿主机

  redis:
    image: redis:7-alpine
    restart: always
    container_name: "miniblog-redis"
    ports:
      - "63790:6379"
    command: >
      redis-server
      --requirepass v6yJM2kAZpOc
      --appendonly yes
      --save 900 1
      --save 300 10
      --save 60 10000
      --maxmemory-policy allkeys-lru
      --bind 0.0.0.0
      --loglevel notice
    volumes:
      - ./.dbdata/redis:/data
